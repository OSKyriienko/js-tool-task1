var assignInWith=require("./assignInWith"),attempt=require("./attempt"),baseValues=require("./_baseValues"),customDefaultsAssignIn=require("./_customDefaultsAssignIn"),escapeStringChar=require("./_escapeStringChar"),isError=require("./isError"),isIterateeCall=require("./_isIterateeCall"),keys=require("./keys"),reInterpolate=require("./_reInterpolate"),templateSettings=require("./templateSettings"),toString=require("./toString"),reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g;function template(e,r,t){var n=templateSettings.imports._.templateSettings||templateSettings;t&&isIterateeCall(e,r,t)&&(r=void 0),e=toString(e),r=assignInWith({},r,n,customDefaultsAssignIn);var i,a,s=assignInWith({},r.imports,n.imports,customDefaultsAssignIn),p=keys(s),o=baseValues(s,p),u=0,l=r.interpolate||reNoMatch,g="__p += '",_=RegExp((r.escape||reNoMatch).source+"|"+l.source+"|"+(l===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(r.evaluate||reNoMatch).source+"|$","g"),c="sourceURL"in r?"//# sourceURL="+r.sourceURL+"\n":"";e.replace(_,function(r,t,n,s,p,o){return n||(n=s),g+=e.slice(u,o).replace(reUnescapedString,escapeStringChar),t&&(i=!0,g+="' +\n__e("+t+") +\n'"),p&&(a=!0,g+="';\n"+p+";\n__p += '"),n&&(g+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=o+r.length,r}),g+="';\n";var m=r.variable;m||(g="with (obj) {\n"+g+"\n}\n"),g=(a?g.replace(reEmptyStringLeading,""):g).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),g="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+g+"return __p\n}";var S=attempt(function(){return Function(p,c+"return "+g).apply(void 0,o)});if(S.source=g,isError(S))throw S;return S}module.exports=template;